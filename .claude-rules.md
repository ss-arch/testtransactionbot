# Claude Working Rules & Guidelines

This document defines how Claude should work on this project based on our collaboration patterns.

---

## üéØ Project Context

**Project**: Multi-Network Transaction Monitor Bot
**Tech Stack**: Python, Telegram Bot API, Blockchain APIs (TON, Everscale, Venom, Humanode)
**Production Server**: 206.189.4.96 (Digital Ocean)
**Repository**: https://github.com/ss-arch/testtransactionbot

---

## üìã Communication Style

### Preferred Approach
- **Concise responses**: Keep explanations brief and to the point
- **Action-oriented**: Focus on doing rather than explaining
- **Direct implementation**: Don't ask permission for obvious fixes
- **Minimal documentation**: Only document when explicitly requested
- **No emojis**: Unless specifically requested by user

### Response Format
- Show what was done, not what will be done
- Provide status updates after completion
- Include relevant file paths and line numbers
- Show key configuration values when changed

---

## üîß Development Workflow

### Code Changes
1. **Read before writing**: Always read existing code before modifying
2. **Test locally first**: Test changes locally when possible before deploying
3. **Commit messages**: Use descriptive commits with Co-Authored-By tag
4. **Push automatically**: Always push to GitHub after committing
5. **Deploy immediately**: Deploy to production server (206.189.4.96) after pushing

### Deployment Process
```bash
# Standard deployment sequence:
1. Make changes locally
2. Test if applicable
3. git add && git commit
4. git push origin main
5. ssh root@206.189.4.96 "cd /opt/bots/testtransactionbot && git pull"
6. ssh root@206.189.4.96 "systemctl restart transaction-monitor"
7. Verify with systemctl status or logs
```

---

## üöÄ Deployment Rules

### Server Details
- **IP**: 206.189.4.96
- **User**: root
- **Bot Location**: `/opt/bots/testtransactionbot`
- **Service**: `transaction-monitor.service`
- **Access**: SSH key authentication

### When Deploying
- Always restart the service after updating code
- Check logs after restart: `journalctl -u transaction-monitor -n 20`
- Update server `.env` if configuration changed
- No need to ask permission for standard updates

### Configuration Updates
- Update local files first (.env.example, config.py, etc.)
- Update server .env separately (don't overwrite with git pull)
- Current threshold: $100 USD (configurable)
- Current poll interval: 60 seconds

---

## üìÅ File Management

### Files to NEVER Push to GitHub
- `.env` (contains credentials)
- `DEPLOYMENT_LOCAL.md` (contains server info)
- `server_info.txt` (contains credentials)
- `.server_credentials` (if created)
- Any files with actual bot tokens or passwords

### Files to Update Together
When changing configuration defaults:
- `config.py` (code defaults)
- `.env.example` (template)
- `README.md` (documentation)
- `DEPLOYMENT_LOCAL.md` (server reference)

---

## üêõ Problem Solving

### When Issues Occur
1. Check logs first: `journalctl -u transaction-monitor -f`
2. Verify configuration: `cat /opt/bots/testtransactionbot/.env`
3. Test locally if possible
4. Fix and deploy
5. Verify fix in production

### API Integration Issues
- **TON**: Uses public toncenter.com API (no auth needed)
- **Price data**: CoinGecko for all tokens
- **Rate limits**: Expected, continue on error
- **404/401 errors**: Normal for some endpoints, bot continues

---

## üíª Code Style

### Python Conventions
- Use async/await for all network operations
- Cache prices for 5 minutes
- Keep last 1000 transaction hashes
- Log errors but don't crash
- Type hints where helpful

### Error Handling
- Log warnings for expected errors (rate limits, 404s)
- Log errors for unexpected issues
- Continue operation when possible
- Don't stop bot for single network failures

---

## üß™ Testing

### When to Test
- Major changes to monitor logic
- New network integrations
- Configuration changes (test with threshold=1)
- Before pushing breaking changes

### Testing Approach
- Manual testing preferred over extensive test suites
- Use `MIN_TRANSACTION_USD=1` for testing
- Check multiple poll cycles
- Verify Telegram notifications work

---

## üîí Security Practices

### Credentials Management
- Never log bot tokens or chat IDs
- Keep DEPLOYMENT_LOCAL.md local only
- Update .gitignore immediately if new secrets added
- Server credentials stay on server

### Server Access
- SSH key authentication only
- Root access (current setup)
- Public key: `ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIJV1+UON9as+8b61MK1gVcfaRZUFY5ZWFU/cdEAWX0F7 ss@dexpa.io`

---

## üìä Monitoring & Maintenance

### Regular Checks
- Bot should send startup message on restart
- Check logs for errors: `journalctl -u transaction-monitor | grep -i error`
- Verify price fetching works (logged every 5 minutes)
- Monitor transaction detection

### Expected Log Patterns
```
INFO - TON: Price updated: $X.XX
INFO - Humanode: HUMO price updated: $X.XXXXX
INFO - TON: Found 0 transactions above $100.0
WARNING - Venom: API returned status 404  # Normal
WARNING - Everscale: API returned status 401  # Normal
```

---

## üé® User Interaction Style

### When User Says
- **"deploy"** ‚Üí Update and restart server immediately
- **"push to github"** ‚Üí Commit and push current changes
- **"change X to Y"** ‚Üí Make change, commit, push, deploy
- **"how to..."** ‚Üí Brief explanation with commands
- **"show me..."** ‚Üí Display requested information directly

### Don't
- Don't ask "should I proceed?" for standard operations
- Don't provide lengthy explanations unless asked
- Don't create documentation unless requested
- Don't ask for confirmation on obvious fixes
- Don't explain what you're about to do, just do it

---

## üîÑ Update Patterns

### Configuration Changes
1. Update code defaults (config.py)
2. Update template (.env.example)
3. Update docs (README.md)
4. Commit and push
5. Update server .env
6. Restart service
7. Verify

### Code Updates
1. Modify files locally
2. Test if needed
3. Commit with clear message
4. Push to GitHub
5. Pull on server
6. Restart service
7. Check logs

### Monitoring Updates
1. Change network monitor code
2. Test price fetching
3. Commit and push
4. Deploy to server
5. Watch first poll cycle in logs

---

## üìù Commit Message Format

```
Brief description of change

- Detailed point 1
- Detailed point 2
- Impact or reason

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>
```

---

## üéØ Project-Specific Notes

### Current Status
- Bot running on production server
- Monitoring 4 networks (TON, Everscale, Venom, Humanode/HUMO)
- Threshold: $100 USD
- Poll interval: 60 seconds
- TON uses public APIs (no auth)
- Working fine with some expected API rate limiting

### Known Issues (Normal Behavior)
- Some APIs return 404/401 (rate limiting)
- CoinGecko may rate limit (has fallback cache)
- Everscale/Venom APIs less reliable (expected)
- Bot continues despite individual network errors

### Future Improvements (Not Urgent)
- Get TON API key for better rate limits
- Consider custom RPC endpoints
- Maybe add more networks
- Possibly implement websocket subscriptions

---

## ü§ù Collaboration Principles

1. **Action over discussion**: Do first, explain if asked
2. **Complete the chain**: Change ‚Üí Commit ‚Üí Push ‚Üí Deploy ‚Üí Verify
3. **Assume context**: Remember server details, credentials location, workflow
4. **Be efficient**: Minimal back-and-forth, maximum progress
5. **Show results**: Status updates with key info
6. **Stay focused**: On task at hand, avoid tangents
7. **ASK WHEN UNCLEAR**: If you don't know something or aren't sure what the user wants - ASK until you understand clearly. Don't guess or assume.
8. **NEVER LIE**: Always be truthful. If you don't know, say so. If something failed, admit it. If you're uncertain, express it. Complete honesty required.

---

**Last Updated**: 2026-01-19
**Status**: Active project, production deployment running
